<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Consensus and Blockchain · NKN Docs</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Consensus and Blockchain"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Consensus and Blockchain · NKN Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.nkn.org/"/><meta property="og:description" content="# Consensus and Blockchain"/><meta property="og:image" content="https://docs.nkn.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.nkn.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/favicon.png" alt="NKN Docs"/><h2 class="headerTitleWithLogo">NKN Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/home" target="_self">Docs</a></li><li class=""><a href="/docs/command-line-wallet-cn" target="_self">文档</a></li><li class=""><a href="https://github.com/nknorg/nkn" target="_self">GitHub</a></li><li class=""><a href="https://nkn.org" target="_self">NKN</a></li><li class=""><a href="https://github.com/nknorg/nkn/wiki" target="_self">Help</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Consensus and Blockchain</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="consensus-and-blockchain"></a><a href="#consensus-and-blockchain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consensus and Blockchain</h1>
<h2><a class="anchor" aria-hidden="true" id="consensus-protocol"></a><a href="#consensus-protocol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consensus Protocol</h2>
<p>Consensus is achieved among nodes using the Major Vote Cellular
Automata (MOCA) algorithm as described in our whitepaper. MOCA is
efficient in both time and message count as only a few iterations of
communications between neighbors are needed to reach consensus, as
shown in the whitepaper.</p>
<p>Information required for consensus (e.g. next block) is sent to all
participating nodes at the beginning of the consensus through a
gossip-like protocol that takes up to O(logN) time, which is the main
time cost for consensus process. Such time can be reduced to
O(logN/logk) by having up to k times more neighbors similar to
Kademlia DHT as we may implement in our future version.</p>
<p>The consensus algorithm can be implemented by an event-driven protocol
triggered by consensus messages. Every consensus message has a topic
id identifying what is being agreed on. For each consensus message
received from a neighbor regarding a binary state (e.g. accept or
reject a block), the following procedures are executed:</p>
<ol>
<li><p>If it��s the first message with the topic id, then compute self
initial state and send the state to neighbors.</p></li>
<li><p>Update sender��s state for the topic id.</p></li>
<li><p>If more than half of the nodes choosing self as neighbor have the
other state from self state for the topic id, then change self state
to the majority state and send the state to neighbors.</p></li>
</ol>
<p>The consensus process for a topic id stops after a fixed amount of
time since first receiving messages with the same topic id. The
correctness and convergence of the MVCA algorithm is shown in our
whitepaper.</p>
<h2><a class="anchor" aria-hidden="true" id="block-creation"></a><a href="#block-creation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Block Creation</h2>
<p>New block is added to the blockchain by first selecting a ��leader��
that proposes the new block. The leader selection is uncontrollable
but verifiable. The expected probability that a node is elected as
leader is proportional to the data relayed by the node on secure
paths. The selected leader proposes the next block and sends it to the
network for confirmation. The proposed block will be added to the
blockchain as the next block if consensus among nodes is reached.</p>
<h3><a class="anchor" aria-hidden="true" id="leader-selection"></a><a href="#leader-selection" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Leader Selection</h3>
<p>Leader is selected by first selecting a signature chain on a secure
path. The signature chain being selected is the one that has the
lowest last signature value. As discussed before, signature cannot be
predicted or forged until a malicious party has controlled all nodes
in the chain. On the other hand, any malicious party has trivial
probability to control all nodes on a secure path. These two
properties combined guarantees that selecting the signature chain with
lowest last signature on secure paths is effectively randomly
selecting signature chain on secure paths and the selection cannot be
predicted or controlled by any party.</p>
<p>To select the signature chain with lowest last signature, each node
who signs the last signature checks if the last signature is smaller
than a threshold. If the last signature is smaller than the threshold,
the node sends out the signature chain to the network as a candidate
for the lowest last signature. The threshold is chosen so that with
high probability, the lowest last signature is smaller than the
threshold. Let t be the threshold in unit of largest possible
signature value, and the signature is distributed uniformly from 0 to
the largest value. The probability that all last signature are above
the threshold is (1 - t)^L, where L is the number of signature
chain. We need (1 - t)^L &lt; e where e is small enough. For small t we
have t &gt; - (log e) / L. We choose t = - (log e) / L to minimize the
number of candidates. L can be estimated from the average number of
signature chains in a number of previous blocks.</p>
<p>Nodes reach consensus about signature chain selection after receiving
candidates. The initial choice of each node is the signature chain
candidate with lowest last signature. If all nodes receive the same
candidates, then consensus is trivial as all honest nodes will make
the same initial choice. Otherwise the same signature chain (but not
necessarily the one with global lowest signature if initially it is
not received by enough nodes) will be guaranteed by the consensus
protocol.</p>
<p>When consensus about the signature chain is reached, leader is chosen
deterministic from the signature chain. Let S be the last signature of
the signature chain. Relay nodes on the signature chain are labeled
from 0 to L-1, where L is the number of relay nodes. Then the leader
is the node with label S mod L on the signature chain.</p>
<h3><a class="anchor" aria-hidden="true" id="block-creation-1"></a><a href="#block-creation-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Block Creation</h3>
<p>Block is proposed by the selected leader in each round. Proposed block
is sent to all nodes for verification and consensus. During consensus
phase, each node sends to its neighbors the hash of the block (in case
the leader sends out different blocks to different neighbors) and if
it is accepted or not. When consensus is reached, all nodes should
have the same accepted block or none if rejected. Proposed block is
added to the blockchain if accepted.</p>
<h2><a class="anchor" aria-hidden="true" id="state-transition"></a><a href="#state-transition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>State Transition</h2>
<p>Leader selection and block creation and running in parallel.</p>
<p>Leader selection for block epoch n starts after both leader selection
for block n-1 and block creation for block opoch n-2 are finished, and
runs in parallel with the block creation for block n-1. In leader
selection process, each node has 3 different states: listening state,
waiting for candidates state and candidate consensus state.</p>
<p>In listening state, node waits for signature chain that is valid for
mining (candidate). Once it receives or produces a valid candidate, it
transits into waiting for candidates state. In this state, node sends
out new candidate signature chain(s) it mined since last listening
state.</p>
<p>In waiting for candidates state, node still accepts and relays
candidates, but will not send out new candidates it mined. The propose
of this state is waiting for candidates sent out during listening
state to finish propagating. Node stays in waiting for candidates
state for a fixed time before transiting to candidate consensus state.</p>
<p>In candidate consensus state, node receives neighbors' states on each
candidate indicating whether to choose the candidate. If more than
half of the neighbors have the opposite state on a candidate than
itself, node updates its state and sends the new one to its
neighbors. Node also sends its initial states to neighbors when
entering candidate consensus state. Consensus is finished after a
fixed time since entering the candidate consensus state.</p>
<p>Block creation runs in parallel with leader selection, but one epoch
behind. Block creation for block epoch n starts after both leader
selection for block n and block creation for block n-1 are
finished. There are 2 states in block creation process: listening
state and block consensus state.</p>
<p>In listening state, node waits for block proposed by the selected
candidate. Once it receives a proposed block, it transits into block
consensus state.</p>
<p>Block consensus state is similar to candidate consensus state, except
that nodes vote for block rather than candidate. If node receives more
than one proposed block signed by the candidate, it will vote for none
of the proposed blocks because it indicates that the selected
candidate is not honest (propose multiple blocks).</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#consensus-protocol">Consensus Protocol</a></li><li><a href="#block-creation">Block Creation</a><ul class="toc-headings"><li><a href="#leader-selection">Leader Selection</a></li><li><a href="#block-creation-1">Block Creation</a></li></ul></li><li><a href="#state-transition">State Transition</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><img src="/img/favicon.png" alt="Bowler" height="45"/><a href="https://nkn.org">NKN</a><a href="https://twitter.com/NKN_ORG">Twitter</a><a href="https://github.com/nknorg/nkn">GitHub</a><a href="https://forum.nkn.org">Forum</a></section><section class="copyright">Copyright © 2025 NKN | All rights reserved</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '4a0261289a8269108860d1988a7e48f6',
                indexName: 'nkn',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>